% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kmFit.R
\name{kmFit}
\alias{kmFit}
\title{Linear mixed effects models with kinship for RNA-seq}
\usage{
kmFit(
  dat = NULL,
  kin = NULL,
  patientID = "ptID",
  libraryID = "libID",
  counts = NULL,
  meta = NULL,
  genes = NULL,
  weights = NULL,
  subset.var = NULL,
  subset.lvl = NULL,
  subset.genes = NULL,
  model,
  use.weights = FALSE,
  run.lm = FALSE,
  run.lme = FALSE,
  run.lmerel = FALSE,
  metrics = FALSE,
  run.lmekin = NULL,
  run.contrast = FALSE,
  contrast.var = NULL,
  processors = NULL,
  p.method = "BH",
  genotype.name = NULL
)
}
\arguments{
\item{dat}{EList object output by voom( ). Must contain counts (dat$E) and meta (dat$targets). Optionally also contains gene metadata (dat$genes) and weights (dat$weights)}

\item{kin}{Matrix with pairwise kinship values between individuals. Must be numeric with rownames.}

\item{patientID}{Character of variable name to match dat$targets to kinship row and column names.}

\item{libraryID}{Character of variable name to match dat$targets to dat$E colnames}

\item{counts}{Matrix of normalized expression. Rows are genes, columns are libraries.}

\item{meta}{Matrix or data frame of sample and individual metadata.}

\item{genes}{Optional matrix or data frame of gene metadata.}

\item{weights}{Optional matrix of data frame of gene specific weights. Usually calculated with limma::voomWithQualityWeights().}

\item{subset.var}{Character list of variable name(s) to filter data by.}

\item{subset.lvl}{Character list of variable value(s) or level(s) to filter data to. Must match order of subset.var}

\item{subset.genes}{Character vector of genes to include in models.}

\item{model}{Character vector of model starting with ~ Should include (1|patientID) if mixed effects will be run}

\item{use.weights}{Logical if gene specific weights should be used in model. Default is FALSE}

\item{run.lm}{Logical if should run lm model without kinship}

\item{run.lme}{Logical if should run lme model without kinship}

\item{run.lmerel}{Logical if should run lmerel model with kinship}

\item{metrics}{Logical if should calculate model fit metrics such as AIC, BIC, R-squared. Default is FALSE}

\item{run.lmekin}{Depreciated. Please use run.lmerel}

\item{run.contrast}{Logical if should run pairwise contrasts. If no matrix provided, all possible pairwise comparisons are completed.}

\item{contrast.var}{Character vector of variable in model to run contrasts of. Interaction terms must be specified as "var1:var2". If NULL (default), all contrasts for all variables in the model are run}

\item{processors}{Numeric processors to run in parallel. Default is 2 less than the total available}

\item{p.method}{Character of FDR adjustment method. Values as in p.adjust( )}

\item{genotype.name}{Character string. Used internally for kmFit_eQTL}
}
\value{
List of data frames including
   - lm/lme/lmerel: model estimates and significance
   - *.contrast: model estimates and significance for pairwise contrasts with variables in the original model
   - *.fit: model fit metrics such as sigma, AIC, BIC, R-squared (optional with metrics paramater)
   - *.error: error messages for genes that failed model fitting
}
\description{
Run lmerel and corresponding lm or lme without kinship of gene expression in RNA-seq data
}
\examples{
# All samples and all genes
## Not run
# kmFit(dat = example.voom,
#     kin = example.kin, run.lmerel = TRUE,
#     model = "~ virus + (1|ptID)")

# Subset samples and genes
## Also with weights
kmFit(dat = example.voom,
      run.lm = TRUE, use.weights = FALSE,
      subset.var = list("asthma"), subset.lvl = list(c("asthma")),
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ virus + (1|ptID)")

# Pairwise contrasts
## Continuous interaction
kmFit(dat = example.voom,
      run.lme = TRUE, run.contrast = TRUE,
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ virus + asthma * median_cv_coverage + (1|ptID)",
      contrast.var=c("virus","asthma:median_cv_coverage"))

## Categorical interaction
kmFit(dat = example.voom, kin = example.kin,
      run.lmerel = TRUE, run.contrast = TRUE, metrics=TRUE,
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ virus*asthma + (1|ptID)",
      contrast.var=c("virus","virus:asthma"))

# Model with failed genes
kmFit(dat = example.voom,
      kin = example.kin, run.lmerel = TRUE, run.lm = TRUE,
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ virus*asthma + lib.size + norm.factors + median_cv_coverage + ptID + (1|ptID)")

# Non-dat data
kmFit(counts = example.voom$E, meta = example.voom$targets,
      run.lm = TRUE, use.weights = FALSE,
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ virus + (1|ptID)")

# Three level variable
example.voom$targets$lvl <- rep(c("A","B","C"), length(example.voom$targets$libID)/3)
kmFit(dat = example.voom,
      run.lme= TRUE, run.contrast = TRUE,
      subset.genes = c("ENSG00000250479","ENSG00000250510","ENSG00000255823"),
      model = "~ lvl + (1|ptID)")

}
